<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MVSD Grand Casino - Admin</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1 class="neon">MVSD Grand Casino - Admin</h1>
        <nav>
            <a href="index.html">Home</a>
            <a href="games.html">Games</a>
            <a href="shop.html">Shop</a>
            <a href="leaderboard.html">Leaderboard</a>
            <a href="about.html">About</a>
            <a href="contact.html">Contact</a>
        </nav>
        <div id="auth-buttons">
            <button id="login-btn" class="btn-small">Login</button>
            <button id="register-btn" class="btn-small">Register</button>
        </div>
    </header>

    <section class="hero">
        <div class="hero-content">
            <h2>Admin Panel</h2>
            <p>Manage the casino operations.</p>
        </div>
    </section>

    <section class="admin-section">
        <div class="admin-container">
            <div class="admin-panel">
                <h3 class="neon-gold">User Management</h3>
                <button id="view-users-btn" class="btn">View All Users</button>
                <div id="users-list" class="admin-list"></div>
            </div>
            <div class="admin-panel">
                <h3 class="neon-gold">Inventory Management</h3>
                <button id="view-house-inventory-btn" class="btn">View House Inventory</button>
                <button id="manage-shop-btn" class="btn">Manage Shop</button>
                <div id="inventory-list" class="admin-list"></div>
            </div>
            <div class="admin-panel">
                <h3 class="neon-gold">Game Settings</h3>
                <button id="adjust-payouts-btn" class="btn">Adjust Payouts</button>
                <button id="adjust-chances-btn" class="btn">Adjust Chances</button>
                <div id="settings-list" class="admin-list"></div>
            </div>
            <div class="admin-panel">
                <h3 class="neon-gold">Lootbox Management</h3>
                <button id="view-lootboxes-btn" class="btn">View Lootboxes</button>
                <button id="create-lootbox-btn" class="btn">Create Lootbox</button>
                <div id="lootbox-list" class="admin-list"></div>
            </div>
            <div class="admin-panel">
                <h3 class="neon-gold">Game Statistics</h3>
                <div id="game-stats"></div>
            </div>
            <div class="admin-panel">
                <h3 class="neon-gold">System Controls</h3>
                <button id="reset-data-btn" class="btn">Reset All Data</button>
                <button id="export-data-btn" class="btn">Export Data</button>
            </div>
        </div>
    </section>

    <!-- Authentication Modals -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Login</h2>
            <form id="login-form">
                <input type="email" id="login-email" placeholder="Email" required>
                <input type="password" id="login-password" placeholder="Password" required>
                <button type="submit" class="btn">Login</button>
            </form>
            <p>Don't have an account? <a href="#" id="switch-to-register">Register here</a></p>
        </div>
    </div>

    <div id="register-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Register</h2>
            <form id="register-form">
                <input type="email" id="register-email" placeholder="Email" required>
                <input type="text" id="register-username" placeholder="Username" required>
                <input type="password" id="register-password" placeholder="Password" required>
                <button type="submit" class="btn">Register</button>
            </form>
            <p>Already have an account? <a href="#" id="switch-to-login">Login here</a></p>
        </div>
    </div>

    <footer>
        <p>&copy; 2026 MVSD Grand Casino. All rights reserved.</p>
    </footer>

    <script src="script.js"></script>
    <script>
        // Admin functionality
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser || currentUser.username !== 'admin') {
                document.querySelector('.admin-section').innerHTML = '<p class="neon">Access denied. Admin only.</p>';
                return;
            }

            document.getElementById('view-users-btn').addEventListener('click', viewUsers);
            document.getElementById('view-house-inventory-btn').addEventListener('click', viewHouseInventory);
            document.getElementById('manage-shop-btn').addEventListener('click', manageShop);
            document.getElementById('adjust-payouts-btn').addEventListener('click', adjustPayouts);
            document.getElementById('adjust-chances-btn').addEventListener('click', adjustChances);
            document.getElementById('view-lootboxes-btn').addEventListener('click', viewLootboxes);
            document.getElementById('create-lootbox-btn').addEventListener('click', createLootbox);
            document.getElementById('reset-data-btn').addEventListener('click', resetData);
            document.getElementById('export-data-btn').addEventListener('click', exportData);

            updateGameStats();
        });

        function viewUsers() {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const usersList = document.getElementById('users-list');
            usersList.innerHTML = '<h4>All Users:</h4><table><tr><th>Username</th><th>Email</th><th>Balance</th><th>Games</th><th>Actions</th></tr>';
            users.forEach(user => {
                usersList.innerHTML += `
                    <tr>
                        <td>${user.username}</td>
                        <td>${user.email}</td>
                        <td>${user.balance}</td>
                        <td>${user.gamesPlayed || 0}</td>
                        <td>
                            <button onclick="adjustBalance('${user.email}', 100)">+100</button>
                            <button onclick="adjustBalance('${user.email}', -100)">-100</button>
                            <button onclick="viewUserInventory('${user.email}')">View Inv</button>
                        </td>
                    </tr>
                `;
            });
            usersList.innerHTML += '</table>';
        }

        function adjustBalance(email, amount) {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const userIndex = users.findIndex(u => u.email === email);
            if (userIndex !== -1) {
                users[userIndex].balance += amount;
                if (users[userIndex].balance < 0) users[userIndex].balance = 0;
                localStorage.setItem('users', JSON.stringify(users));
                viewUsers();
                updateGameStats();
            }
        }

        function updateGameStats() {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const totalUsers = users.length;
            const totalBalance = users.reduce((sum, user) => sum + user.balance, 0);
            const totalGames = users.reduce((sum, user) => sum + (user.gamesPlayed || 0), 0);

            document.getElementById('game-stats').innerHTML = `
                <p>Total Users: ${totalUsers}</p>
                <p>Total Credits in Circulation: ${totalBalance}</p>
                <p>Total Games Played: ${totalGames}</p>
            `;
        }

        function resetData() {
            if (confirm('Are you sure you want to reset all data? This cannot be undone!')) {
                localStorage.clear();
                alert('All data reset!');
                location.reload();
            }
        }

        function viewUserInventory(email) {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const user = users.find(u => u.email === email);
            if (user) {
                const inventory = user.inventory || [];
                alert(`Inventory for ${user.username}:\n${inventory.length ? inventory.join('\n') : 'Empty'}`);
            }
        }

        function viewHouseInventory() {
            const houseInventory = JSON.parse(localStorage.getItem('houseInventory')) || [];
            const inventoryList = document.getElementById('inventory-list');
            inventoryList.innerHTML = '<h4>House Inventory:</h4>';
            if (houseInventory.length) {
                houseInventory.forEach(item => {
                    inventoryList.innerHTML += `<div>${item.name} (Value: ${item.value})</div>`;
                });
            } else {
                inventoryList.innerHTML += '<p>Empty</p>';
            }
        }

        function manageShop() {
            // Simple shop management: add skins to shop
            const skins = JSON.parse(localStorage.getItem('skins')) || [];
            if (!skins.length) {
                // Load skins if not loaded
                fetch('data/skins.json').then(r => r.json()).then(data => {
                    localStorage.setItem('skins', JSON.stringify(data));
                    manageShop();
                });
                return;
            }
            const shop = JSON.parse(localStorage.getItem('shop')) || [];
            const inventoryList = document.getElementById('inventory-list');
            inventoryList.innerHTML = '<h4>Shop Management:</h4>';
            skins.slice(0, 10).forEach(skin => {
                const inShop = shop.find(s => s.name === skin.name);
                inventoryList.innerHTML += `
                    <div>
                        ${skin.name} (${skin.value})
                        ${inShop ? '<button onclick="removeFromShop(\'' + skin.name + '\')">Remove from Shop</button>' : '<button onclick="addToShop(\'' + skin.name + '\')">Add to Shop</button>'}
                    </div>
                `;
            });
        }

        function addToShop(name) {
            const skins = JSON.parse(localStorage.getItem('skins')) || [];
            const shop = JSON.parse(localStorage.getItem('shop')) || [];
            const skin = skins.find(s => s.name === name);
            if (skin && !shop.find(s => s.name === name)) {
                shop.push(skin);
                localStorage.setItem('shop', JSON.stringify(shop));
                manageShop();
            }
        }

        function removeFromShop(name) {
            const shop = JSON.parse(localStorage.getItem('shop')) || [];
            const newShop = shop.filter(s => s.name !== name);
            localStorage.setItem('shop', JSON.stringify(newShop));
            manageShop();
        }

        function adjustPayouts() {
            const settings = JSON.parse(localStorage.getItem('gameSettings')) || {};
            const settingsList = document.getElementById('settings-list');
            settingsList.innerHTML = '<h4>Adjust Payouts:</h4>';
            ['slots', 'dice', 'roulette', 'crash', 'coinflip'].forEach(game => {
                const payout = settings[game]?.payout || 10;
                settingsList.innerHTML += `
                    <div>
                        ${game}: <input type="number" id="payout-${game}" value="${payout}">
                        <button onclick="setPayout('${game}')">Set</button>
                    </div>
                `;
            });
        }

        function setPayout(game) {
            const val = parseInt(document.getElementById(`payout-${game}`).value);
            const settings = JSON.parse(localStorage.getItem('gameSettings')) || {};
            settings[game] = settings[game] || {};
            settings[game].payout = val;
            localStorage.setItem('gameSettings', JSON.stringify(settings));
            alert(`Payout for ${game} set to ${val}`);
        }

        function adjustChances() {
            const settings = JSON.parse(localStorage.getItem('gameSettings')) || {};
            const settingsList = document.getElementById('settings-list');
            settingsList.innerHTML = '<h4>Adjust Chances:</h4>';
            ['dice', 'roulette', 'coinflip'].forEach(game => {
                const chance = settings[game]?.chance || 50;
                settingsList.innerHTML += `
                    <div>
                        ${game}: <input type="number" id="chance-${game}" value="${chance}">
                        <button onclick="setChance('${game}')">Set</button>
                    </div>
                `;
            });
        }

        function setChance(game) {
            const val = parseInt(document.getElementById(`chance-${game}`).value);
            const settings = JSON.parse(localStorage.getItem('gameSettings')) || {};
            settings[game] = settings[game] || {};
            settings[game].chance = val;
            localStorage.setItem('gameSettings', JSON.stringify(settings));
            alert(`Chance for ${game} set to ${val}%`);
        }

        function viewLootboxes() {
            const lootboxes = JSON.parse(localStorage.getItem('lootboxes')) || [];
            const lootboxList = document.getElementById('lootbox-list');
            lootboxList.innerHTML = '<h4>Lootboxes:</h4><table><tr><th>Name</th><th>Cost</th><th>Quantity</th><th>Items</th><th>Actions</th></tr>';
            lootboxes.forEach((lb, index) => {
                lootboxList.innerHTML += `
                    <tr>
                        <td>${lb.name}</td>
                        <td>${lb.cost || 0}</td>
                        <td>${lb.quantity || 0}</td>
                        <td>${lb.items ? lb.items.length : 0}</td>
                        <td>
                            <button onclick="editLootbox(${index})">Edit</button>
                            <button onclick="deleteLootbox(${index})">Delete</button>
                        </td>
                    </tr>
                `;
            });
            lootboxList.innerHTML += '</table>';
        }

        function editLootbox(index) {
            const lootboxes = JSON.parse(localStorage.getItem('lootboxes')) || [];
            const lb = lootboxes[index];
            const newName = prompt('Name:', lb.name);
            const newCost = parseInt(prompt('Cost:', lb.cost));
            const newQuantity = parseInt(prompt('Quantity:', lb.quantity));
            if (newName && newCost && newQuantity) {
                lootboxes[index] = { ...lb, name: newName, cost: newCost, quantity: newQuantity };
                localStorage.setItem('lootboxes', JSON.stringify(lootboxes));
                viewLootboxes();
            }
        }

        function deleteLootbox(index) {
            if (confirm('Delete this lootbox?')) {
                const lootboxes = JSON.parse(localStorage.getItem('lootboxes')) || [];
                lootboxes.splice(index, 1);
                localStorage.setItem('lootboxes', JSON.stringify(lootboxes));
                viewLootboxes();
            }
        }
    </script>
</body>
</html>
